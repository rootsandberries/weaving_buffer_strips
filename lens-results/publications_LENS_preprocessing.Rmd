---
title: "publications_LENS_preprocessing"
output:
  html_document:
    code_folding: hide
    toc: TRUE
    toc_float: TRUE
    toc_depth: 4
    collapsed: FALSE
    YAML: rmdformats::robobook
editor_options: 
  chunk_output_type: console
---


```{r setup, include = FALSE, eval = TRUE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#library(ggpubr)
library(tidyverse)
library(here) #use: here("subfolder", "filename")
library(httr)
library(jsonlite)
library(ggplot2)
library(ggrepel)
library(expss)
library(igraph)
```

## Summary
This code starts from the list of the 1019 included articles stored in **20201215_EGM_Net_all-articles_clean.csv** and runs a query via LENS API custom function to retrieve their detailed bibliographic information. Retrieved data is processed to remove duplicated records, resulting in 974 records with unique titles. Preliminary summary plots are made for 864 records contain lists of references represented as LENS reference ID. Out of 974 records, 859 are journal articles, 752 have DO, publication years span 1954 - 2018.  The data is stored as a hierarchical data object with multiple levels of nested data tables (**record_df** stored in **LENS_dataframe.RData**). Subsequent code is used to extract and flatten the selected data structures, remove redundancies and resolve conflicting information on the authors and their  countries of affiliation, a few duplicated articles are removed.    

After this pre-processing code, **publications_LENS_igraph.Rmd** can be run to produce bibliographic (collaboration) networks.  


## Load data (list of articles) from a .csv file

```{r get full list of publications, eval = TRUE}
dat <- read.csv(here("data", "20201215_EGM_Net_all-articles_clean.csv"))
dim(dat) #1019   16
#names(dat)
#hist(dat$year)

# #initial checks
# length(unique(dat$Title)) #1019
# title <- unique(dat$Title)
# length(unique(dat$DOI)) #only 184 DOI values and missing the value is stored as ""! (change to NA later?)
# table(dat$Item_Type) #mostly articles
# hist(dat$Pub_Year, breaks = 70)
# table(dat$Manual_Tags) #stored as vectors of characters, tags separated by "; "
# #table(dat$Item_Type)["journalArticle"] # 959 journal articles
```

## Query for LENS API using article titles

*DO NOT RUN* - the outpt was saved to a file at the end of this chunk - this output is loaded at the start of the next chunk, to save long waiting time during LENS API query.   

```{r query LENS for full records, eval = FALSE}
#subset of first 50  publications, (used for testing)
#dat50 <- dat[1:50, ] # use insted of "dat" in the code below

#Note:   if more than 50 run  receiving message code: 1 rate_limited Too many requests. Allowed '50' per minute. 429 ", the LENS API call loop was changed to accommodate this by adding waiting time between iterations (works slower but returns all available records)

#custom function for accessing LENS API
getLENSData <- function(token, query){
  url <- 'https://api.lens.org/scholarly/search'
  headers <- c('Authorization' = token, 'Content-Type' = 'application/json')
  httr::POST(url = url, add_headers(.headers=headers), body = query)
}

#prepare request
max_results <- 500 #o limit number of records per request, max currently allowed is now 500
article_list <- dat$Title #use dat50$Title for testing
article_title <- article_list[1] #extract the first title from the list
readRenviron("~/.Renviron")
token <- Sys.getenv("LENS_TOKEN") #access token saved in the local environment

#initial query with the first title only
request <- paste0('{"query":  {"match_phrase": {"title": "', paste0('', article_title,'"'),'}}, "size": "',max_results,'","scroll": "1m"}') #, "include": ["lens_id", "authors", "publication_type", "title"] #restrict to certain fields
data <- getLENSData(token, request)
record_json <- content(data, "text")
record_list <- jsonlite::fromJSON(record_json) #convert json output from article search to list
#names(record_list)
#str(record_list$data)
print("iteration = 1")
record_df <- data.frame(record_list) #convert it into a data frame
dim(record_df)
#names(record_df)
#record_df$data.title
#record_df$data.authors
#total <- record_list[["total"]] #1

#use a loop to run query for remaining titles and add them to a data frame of records one by one
for (i in 2:length(article_list)){ 
  article_title <- article_list[i] #extract the title from the list
  request <- paste0('{"query":  {"match_phrase": {"title": "', paste0('', article_title,'"'),'}}, "size": "',max_results,'","scroll": "1m"}') #, "include": ["lens_id", "authors", "publication_type", "title"] #restrict to certain fields
  data <- getLENSData(token, request)
  print(paste("iteration = ",i))
  record_json <- content(data, "text")
  record_list <- jsonlite::fromJSON(record_json) # convert json output from article search to list
  ifelse(record_list$total==0, 
           print(paste0("record not found for: ", article_title)),
            {
            new_df <- data.frame(record_list)
            record_df <- dplyr::bind_rows(record_df, new_df) # bind the latest search data frame to the previous data frame
            }
          )
  Sys.sleep(2.5) #make it slow down to not exceed 50 calls per min
  }


dim(record_df) #1073 out of 1019 - some titles matched multiple records
names(record_df) 
length(unique(record_df$data.title)) #1073 out of 1019 - some titles matched multiple records, 45 not found
#View(cbind(article_list, record_df$data.title)) #shifted positions!

class(record_df) #data frame, but it has nested lists, etc.

save(record_df, file = here("data", "LENS_dataframe.RData")) #save LENS output as a Rdata object
```

Information about LENS output values: https://docs.api.lens.org/response-scholar.html   

## Process LENS output   

```{r processing LENS output, eval = TRUE}
#start from loading save output from LENS
load(here("data", "LENS_dataframe.RData")) #loads record_df data object

names(record_df)
dim(record_df) #1073 34

length(unique(record_df$data.title)) #974 unique titles
#View(record_df[duplicated(record_df$data.title) | duplicated(record_df$data.title, fromLast=TRUE), ]) #visual check - some records have more info than others

sum(sapply(record_df$data.fields_of_study, is.null)) #number of records without fields_of_study, also likely to have other missing data
record_df$data.has_fields_of_study <- sapply(record_df$data.fields_of_study, is.null)

record_df %>% arrange(data.has_fields_of_study, data.title) %>% distinct(data.title, .keep_all = TRUE) -> record_df_unique #place the records without fields_of_study at the end and remove duplicates dim(record_df_unique) #check dimensions
record_df <- record_df_unique #reassign
dim(record_df) #974

#Remove records manually identified as duplicates, commentaries or errors:
remove_ids <- c("135-649-556-815-160",
"023-784-116-518-93X", 
"083-431-696-176-966",
"000-329-490-788-869", 
"161-425-757-559-60X",
"070-142-965-217-664",
"090-581-029-835-945",
"096-184-264-826-781",
"061-017-051-481-03X",
"066-806-618-413-681",
"150-615-763-454-941",
"006-902-184-255-332",
"149-960-450-431-003",
"091-975-063-830-994",
"144-639-707-343-162",
"031-987-261-230-852",
"013-843-692-321-806",
"101-679-988-502-372",
"130-012-333-732-368",
"093-741-681-931-769",
"163-791-444-765-886",
"138-218-733-523-009",
"188-286-702-392-550",
"144-543-953-140-129",
"022-505-451-384-907",
"004-596-005-981-860",
"193-310-481-188-721",
"122-001-509-292-033",
"111-262-221-567-76X",
"132-615-996-627-724",
"162-549-401-379-959",
"080-102-355-958-47X",
"131-532-176-733-767",
"137-332-135-951-858",
"123-619-186-219-552",
"001-177-036-344-113",
"184-194-140-337-897",
"007-335-182-452-066")
record_df <- record_df[ !(record_df$data.lens_id %in% remove_ids), ]
dim(record_df) #936

par(mar=c(4,4,2,2))
hist(record_df$data.year_published, main = "Publication year")
#min(record_df$data.year_published, na.rm = TRUE)
#max(record_df$data.year_published, na.rm = TRUE)

par(mar=c(4,15,2,2))
barplot(sort(table(record_df$data.publication_type)), horiz=TRUE, las=1, xlab = "Count", main = "Publication type")

par(mar=c(4,18,2,2))
barplot(sort(sort(table(record_df$data.source$title),decreasing = TRUE)[1:10]), horiz=TRUE, las=1, xlab = "Count", main = "Top10 publication sources (journals)")

par(mar=c(4,10,2,2))
barplot(sort(sort(table(unlist(record_df$data.fields_of_study)),decreasing = TRUE)[1:10]), horiz=TRUE, las=1, xlab = "Count", main = "Top10 fields of study")
#record_df$data.fields_of_study[[1]][1] #first value from every list for first paper
#record_df$data.fields_of_study[1] #first value from every list for every paper

par(mar=c(4,5,2,2))
barplot(table(!is.na(record_df$data.scholarly_citations_count)), horiz=TRUE, las=1, xlab = "Count", main = "Has count of citations?") #NA should be probably 0

hist(record_df$data.scholarly_citations_count, main = "Number of citations", breaks=100) #ignoring NA
# length(unlist(record_df$data.scholarly_citations)) #45097 total citation LENS ids

par(mar=c(4,5,2,2))
barplot(table(!is.na(record_df$data.references_count)), horiz=TRUE, las=1, xlab = "Count", main = "Has references?")
# length(unlist(record_df$data.references)) #30659 total reference LENS ids

doi <- unlist(lapply(record_df$data.external_ids, function(x) x$value[match('doi', x$type)])) #extracting doi for each article

par(mar=c(4,5,2,2))
barplot(table(!is.na(doi)), horiz=TRUE, las=1, xlab = "Count", main = "Has doi?")
#table(!is.na(doi))[2] #752 have doi

```

Extract authors data.   

```{r extract data for authors, eval=TRUE}
#unnest first level of lists for data.authors
record_df_data.authors <- record_df %>% select(data.lens_id, data.title, data.publication_type, data.year_published, data.authors) %>% unnest(data.authors)
#str(record_df_data.authors) #a tibble with some lists of data frames for ids and affiliations
dim(record_df_data.authors) #3549 - one row for each author (but authors can have multiple IDs and affiliations - nexted in author name)
#names(record_df_data.authors)

#unnest author ids from record_df_data.authors:
record_df_data.authors.ids <- record_df_data.authors %>% select(data.lens_id, data.title, data.publication_type, data.year_published, first_name, last_name, initials, ids) %>% unnest(ids)
#dim(record_df_data.authors.ids) #4052 - one row for each author ID
#names(record_df_data.authors.ids) #a tibble with unnested IDs. Use for igraph: data.lens_id value

record_df_data.authors.ids$Author <- paste(record_df_data.authors.ids$last_name, record_df_data.authors.ids$initials, sep=", ") #add a new column with author name made of last_name and initials

## check overlaps and inconsistencies:
#record_df_data.authors.ids %>% count(Author, type, value, sort = FALSE) %>% View # some authors appear multiple times when multiple ids types are available for them (e.g. 	Aavik, T, Park, KJ, Anderson, SH) - selectively remove orcid (as less common).
#record_df_data.authors.ids %>% count(type, Author, value, sort = FALSE) %>% View  # some authors with multiple ids of the same type (e.g. Bigler, F, Brandle, JR, Bright, JA) 
#record_df_data.authors.ids %>% count(value, type, Author, sort = FALSE) %>% View # some "multiple" authors per id

#View(arrange(record_df_data.authors.ids[duplicated(record_df_data.authors.ids$value) | duplicated(record_df_data.authors.ids$value, fromLast=TRUE), ], value)) #visual check - some records have more info than others

value_check_df <- arrange(record_df_data.authors.ids[duplicated(record_df_data.authors.ids$value) | duplicated(record_df_data.authors.ids$value, fromLast=TRUE), ], value)

value_check_df$value_Author <- paste(value_check_df$type, value_check_df$value, value_check_df$Author, sep="-")
#View(duplicated(distinct(value_check_df, value_Author, .keep_all = TRUE)), ) #654 rows to be checked!

value_check_df %>% 
  group_by(value) %>% 
  filter(n()>1) %>% 
  distinct(value_Author, .keep_all = TRUE) -> value_check_df2
names(value_check_df2)
check_values <- value_check_df2$value[duplicated(value_check_df2$value)] #doi to check


##substitute values with correct author first name and initials:

## fix nr 1 
#orcid 0000-0001-5002-106X "Reberg-Horton, SC" to Reberg-Horton, C
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[1], c("value", "Author", "first_name", "initials")]
#View(record_df_data.authors.ids[record_df_data.authors.ids$last_name == "Reberg-Horton", ]) #one orcid, 3 different magid! - remove all rows with magid, make first name Chris and initials C
record_df_data.authors.ids <- subset(record_df_data.authors.ids, last_name != "Reberg-Horton" | type != "magid")
dim(record_df_data.authors.ids) #remove all records with magid for this person
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0001-5002-106X" & record_df_data.authors.ids$last_name == "Reberg-Horton"] <- "Chris" 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0001-5002-106X" & record_df_data.authors.ids$Author == "Reberg-Horton, SC"] <- "C" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0001-5002-106X" & record_df_data.authors.ids$Author == "Reberg-Horton, SC"] <- "Reberg-Horton, C" 

## fix nr 2
#orcid 0000-0001-5069-0204 "Baker, M" to "Baker, ME" :
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[2], c("value", "Author", "first_name", "initials")]
#record_df_data.authors.ids[record_df_data.authors.ids$value == "0000-0001-5069-0204", ]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0001-5069-0204" & record_df_data.authors.ids$Author == "Baker, M"] <- "Matthew E." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0001-5069-0204" & record_df_data.authors.ids$Author == "Baker, M"] <- "ME" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0001-5069-0204" & record_df_data.authors.ids$Author == "Baker, M"] <- "Baker, ME" 

## fix nr 3
#orcid 0000-0001-6431-9959 "Pywell, R" to "Pywell, RF"
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[3], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0001-6431-9959" & record_df_data.authors.ids$Author == "Pywell, R"] <- "Richard F." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0001-6431-9959" & record_df_data.authors.ids$Author == "Pywell, R"] <- "RF" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0001-6431-9959" & record_df_data.authors.ids$Author == "Pywell, R"] <- "Pywell, RF" 

## fix nr 4
#orcid 0000-0001-9558-0586  "Marshall, E" to "Marshall, EJP"
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[4], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0001-9558-0586" & record_df_data.authors.ids$Author == "Marshall, E"] <- "E. J. P." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0001-9558-0586" & record_df_data.authors.ids$Author == "Marshall, E"] <- "EJP" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0001-9558-0586" & record_df_data.authors.ids$Author == "Marshall, E"] <- "Marshall, EJP" 

## fix nr 5
#orcid 0000-0002-1800-4558 -	Alain	Butet- fix orcid 0000-0002-9173-3466
#orcid 0000-0002-1800-4558 -	Agnes	Fargue-Lelievre - fix orcid 0000-0002-0426-8931 and first name to Agnes
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[5], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "0000-0002-1800-4558" & record_df_data.authors.ids$Author == "Butet, A"] <- "0000-0002-9173-3466" 
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0002-1800-4558" & record_df_data.authors.ids$first_name == "A."] <- "Agnes" 
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "0000-0002-1800-4558" & record_df_data.authors.ids$Author == "Fargue-Lelièvre, A"] <- "0000-0002-0426-8931" 

## fix nr 6 
#orcid 0000-0002-4202-2043 fix "NORRDAHL, K" "K" to "Norrdahl, K" "Kai"
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[6], c("value", "Author", "first_name", "initials", "last_name")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0002-4202-2043" & record_df_data.authors.ids$Author == "NORRDAHL, K"] <- "Kai" 
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "0000-0002-4202-2043" & record_df_data.authors.ids$Author == "NORRDAHL, K"] <- "Norrdahl" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0002-4202-2043" & record_df_data.authors.ids$Author == "NORRDAHL, K"] <- "Norrdahl, K" 

## fix nr 7
#orcid 0000-0003-0300-9951 "Woodcock, B"  "B.A." B" to "Woodcock, BA" "Ben A."
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[7], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0003-0300-9951" & record_df_data.authors.ids$Author == "Woodcock, B"] <- "Ben A." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0003-0300-9951" & record_df_data.authors.ids$Author == "Woodcock, B"] <- "BA" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0003-0300-9951" & record_df_data.authors.ids$Author == "Woodcock, B"] <- "Woodcock, BA" 

## fix nr 8
#orcid 0000-0003-1416-6047 "Bourn, NAD" to "Bourn, NA"
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[8], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0003-1416-6047" & record_df_data.authors.ids$Author == "Bourn, NAD"] <- "Nigel A.D." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0003-1416-6047" & record_df_data.authors.ids$Author == "Bourn, NAD"] <- "NA" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0003-1416-6047" & record_df_data.authors.ids$Author == "Bourn, NAD"] <- "Bourn, NA" 

## fix nr 9
#orcid 0000-0003-3616-5563 "FINN, J" to "Finn, JA"
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[9], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0003-3616-5563" & record_df_data.authors.ids$Author == "FINN, J"] <- "John A." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0003-3616-5563" & record_df_data.authors.ids$Author == "FINN, J"] <- "JA" 
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "0000-0003-3616-5563" & record_df_data.authors.ids$Author == "FINN, J"] <- "Finn" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0003-3616-5563" & record_df_data.authors.ids$Author == "FINN, J"] <- "Finn, JA" 

## fix nr 10
#orcid 0000-0003-3742-7035 "Holland, J" "J.M." to "Holland, JM" "John M."
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[10], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0003-3742-7035" & record_df_data.authors.ids$Author == "Holland, J"] <- "John M." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0003-3742-7035" & record_df_data.authors.ids$Author == "Holland, J"] <- "JM" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0003-3742-7035" & record_df_data.authors.ids$Author == "Holland, J"] <- "Holland, JM" 

## fix nr 11
#orcid 000-0003-4225-9451 "Rahman, M" to "Rahman, MM"
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[11], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0003-4225-9451" & record_df_data.authors.ids$Author == "Rahman, M"] <- "Mizanur Md." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0003-4225-9451" & record_df_data.authors.ids$Author == "Rahman, M"] <- "MM" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0003-4225-9451" & record_df_data.authors.ids$Author == "Rahman, M"] <- "Rahman, MM" 

## fix nr 12
#orcid 0000-0003-4382-7051 "Sparks, T"  "T.H" to "Sparks, TH" "Tim H."
#record_df_data.authors.ids[record_df_data.authors.ids$value == check_values[12], c("value", "Author", "first_name", "initials")]
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "0000-0003-4382-7051" & record_df_data.authors.ids$Author == "Sparks, T"] <- "Tim H." 
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "0000-0003-4382-7051" & record_df_data.authors.ids$Author == "Sparks, T"] <- "TH" 
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "0000-0003-4382-7051" & record_df_data.authors.ids$Author == "Sparks, T"] <- "Sparks, TH" 

# check remaining ids:
#dim(record_df_data.authors.ids)
#table(is.na(record_df_data.authors.ids$type)) #no missing values
#table(is.na(record_df_data.authors.ids$value)) #no missing values
#table(record_df_data.authors.ids$type)

#clean by removing orcid if magid is available
record_df_data.authors.ids %>%
    group_by(data.title, Author) %>%
    filter(type==min(type)) -> record_df_data.authors.ids

#table(record_df_data.authors.ids$type) #3468 - magid, 11 - orcid 

#check how many authors with same name but different ids
record_df_data.authors.ids %>%
    group_by(Author) %>%
    summarise(count = n_distinct(value)) %>%
    filter(count > 1) -> check_next

#select subset of records where same author name has more than one id for manual checking against affiliations etc., then sort and save into a .csv file:
authors_confounded_ids <- record_df_data.authors.ids[c(record_df_data.authors.ids$Author %in% as.character(check_next$Author)), ] 
authors_confounded_ids <- arrange(authors_confounded_ids, Author)

write.csv(authors_confounded_ids, here("data", "lens_confounded_authors_manual_check.csv"))

#dim(check_next) #134 Authors with multiple id values - further checking needed, e.g.:

#example of cleaning these using code, one by one (think of a function to do this?)

## fix nr 13
#View(record_df_data.authors.ids[record_df_data.authors.ids$Author == "Anderson, SH",]) #same as below
#View(record_df_data.authors.ids[record_df_data.authors.ids$Author == as.character(check_next[1,"Author"]), ]) #publication with lens_id 144-115-592-302-602 is a duplicate (conf proceeding) of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "144-115-592-302-602")
record_df <- subset(record_df, data.lens_id != "144-115-592-302-602") #remove from the main dataset

## fix nr 14
#M.	Anjum‚ÄêZubair magid	1969021398 to magid 2432178546	Muhammad Anjum-Zubair:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1969021398"] <- "2432178546"
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "2432178546"] <- "Anjum-Zubair"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2432178546"] <- "Muhammad"

## fix nr 15
#E.J	Asteraki magid	2638401467 to magid 2869471838	E. J.	Asteraki:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2638401467"] <- "2869471838"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2869471838"] <- "E. J."

## fix nr 16
#S Aviron magid	3062457481 to magid 51778602	Stephanie Aviron:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3062457481"] <- "51778602"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "51778602"] <- "Stephanie"

## fix nr 17
#P.	Benoit magid	3206497951 and 2164587776 to magid 3206018185	Pierre	Benoit:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3206497951"] <- "3206018185"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2164587776"] <- "3206018185"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "3206018185"] <- "Pierre"

## fix nr 18
#S Aviron magid	2086633639 to magid 3035619222 Franz	Bigler:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2086633639"] <- "3035619222"

## fix nr 19
#J. R.	Brandle magid	3012274858 to magid 1962060530	James R.	Brandle:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3012274858"] <- "1962060530"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "1962060530"] <- "James R."

## fix nr 20
#Jenny A.	Bright magid	2762875851, 2095964347 to magid 2127488183	Jennifer Anne	Bright:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2762875851"] <- "2127488183"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2095964347"] <- "2127488183"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2127488183"] <- "Jennifer Anne"

## fix nr 21
#Fran√ßoise Burel magid	2924376891 to magid 2277833683	Francoise Burel:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2924376891"] <- "2277833683"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2277833683"] <- "Francoise"

## fix nr 22
#L. W.	Burger magid	2924376891 to magid 2150899759	L. Wes	Burger:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3178819166"] <- "2150899759"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2150899759"] <- "L. Wes"

## fix nr 23
# magid	2111030262 to magid 2484271966 Michael R.	Burkart:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2111030262"] <- "2484271966"

## fix nr 24
# magid	2760876195 to magid 2423641952 C. Nigel R. Critchley:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2760876195"] <- "2423641952"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2423641952"] <- "C. Nigel R."

## fix nr 25
# magid	1988552287 to magid 2228367754 Philip J. Croxton:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1988552287"] <- "2228367754"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2228367754"] <- "Philip J."

## fix nr 26
# magid	1857011976 to magid 2677325151	Cullum, RF:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1857011976"] <- "2677325151"

## fix nr 27
# magid	2132791231 to magid 60885406	De Cauwer, Benny:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2132791231"] <- "60885406"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "60885406"] <- "Benny"

## fix nr 28
# magid	2801754577 to magid 2504157055	Derocles, SAP:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2801754577"] <- "2504157055"

## fix nr 29
# magid	2872534606 to magid 2112395989	Dollar, Jolie G.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2872534606"] <- "2112395989"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2112395989"] <- "Jolie G."

## fix nr 30
# magid	2684909858, 2793022476 to magid 1971355974	Dosskey, Michael G.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2684909858"] <- "1971355974"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2793022476"] <- "1971355974"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "1971355974"] <- " Michael G."

## fix nr 31
# magid	2808773257 to magid 2764292372	Dutin, Gilles:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2808773257"] <- "2764292372"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2764292372"] <- "Gilles"

## fix nr 32
# magid	2696018409, 3114473581 to magid 410375806	Dutoit, Thierry:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2696018409"] <- "410375806"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3114473581"] <- "410375806"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "410375806"] <- "Thierry"

## fix nr 33
# magid	2164558504 and magid 2173160061 are different people with same Author Edwards, PJ - add numbers:	
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2164558504"] <- "Edwards, PJ1"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2173160061"] <- "Edwards, PJ2"

## fix nr 34
# magid	2832089597 to magid 201639963	Eghball, B:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2832089597"] <- "201639963"

## fix nr 35
# magid	668900349 to magid 2980463621	Emmingham, WH:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "668900349"] <- "2980463621"

## fix nr 36
# magid	2154441883 to magid 2676689296	Fox, AF	:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2154441883"] <- "2676689296"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2676689296"] <- "Aaron Freeman"

## fix nr 37
# magid	2098462634 to magid 2261690022	Frampton, GK:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2098462634"] <- "2261690022"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2261690022"] <- "Geoffrey K."

## fix nr 38
#publication with lens_id 069-437-241-458-828 is an erratum of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "069-437-241-458-828")
record_df <- subset(record_df, data.lens_id != "069-437-241-458-828") #remove from the main dataset
# magid	2681877430 to magid 2251024960	Franti, TG:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2681877430"] <- "2251024960"

## fix nr 39
# magid	2713504129 to magid 2712284677	Fry, Gareth L.A.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2713504129"] <- "2712284677"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2712284677"] <- "Gareth L.A."

## fix nr 40
# magid	2555564744 to magid 2096759130	Fuller, Robert J.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2555564744"] <- "2096759130"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2096759130"] <- "Robert J."

## fix nr 41
# magid	2120573253 to magid 2799511157	Gardiner, Tim:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2120573253"] <- "2799511157"

## fix nr 42
# magid	3180815816 to magid 2112883227	Garrett, Harold E.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3180815816"] <- "2112883227"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2112883227"] <- "Harold E."

## fix nr 43
# magid	3117351576 to magid 2153462941	Gilley, JE:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3117351576"] <- "2153462941"

## fix nr 44
# magid	2565660511, 2070281803 to magid 2145334004	Gilliam, J. Wendell:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2565660511"] <- "2145334004"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2070281803"] <- "2145334004"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2145334004"] <- "J. Wendell"

## fix nr 45
#publication with lens_id 038-357-875-647-853 is a duplicate of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "038-357-875-647-853")
record_df <- subset(record_df, data.lens_id != "038-357-875-647-853") #remove from the main dataset

## fix nr 46
# magid	2703779712 to magid 2048417577	Grabow, GL:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2703779712"] <- "2048417577"

## fix nr 47
# magid	2907704750 to magid 2047673052	Grala, Robert Konrad:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2907704750"] <- "2047673052"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2047673052"] <- "Robert Konrad"

## fix nr 48
# magid	2078615988 to magid 2132890577	Grice, Philip V.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2078615988"] <- "2132890577"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2132890577"] <- "Philip V."

## fix nr 49
# magid	1901836219 to magid 2630213313	Gundrey, Anna L:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1901836219"] <- "2630213313"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2630213313"] <- "Anna L."

## fix nr 50
# magid	2515983417 to magid 1995696869	Harrison-Cripps, Jennifer:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2515983417"] <- "1995696869"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "1995696869"] <- "Jennifer"

## fix nr 51
# magid	2980501678 to magid 2228816081	Harrison, William:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2980501678"] <- "2228816081"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2228816081"] <- "William"

## fix nr 52
# magid	1880848158 to magid 3177368442	Haughton, Alison J.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1880848158"] <- "3177368442"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "3177368442"] <- "Alison J."

## fix nr 53
# magid	2704085292 to magid 2279446159	Hausammann, Ariane:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2704085292"] <- "2279446159"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2279446159"] <- "Ariane"

## fix nr 54
# magid	2963183393 and 2637350545 to magid 2629351487	Haycock, Nicholas E.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2963183393"] <- "2629351487"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2637350545"] <- "2629351487"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2629351487"] <- "Nicholas E."

## fix nr 55
# magid	3060985268 to magid 2126549186	Herzog, Felix:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3060985268"] <- "2126549186"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2126549186"] <- "Felix"

## fix nr 56
# magid	2711233669 to magid 2635499295	Hirsh, Sarah M.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2711233669"] <- "2635499295"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2635499295"] <- "Sarah M."

## fix nr 57
# magid	2791690635 to magid 2659214199	Hoagland, Kyle D.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2791690635"] <- "2659214199"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2659214199"] <- "Kyle D."

## fix nr 58
# magid	2703823451 to magid 2620733497	Huusela-Veistola, Erja:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2703823451"] <- "2620733497"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2620733497"] <- "Erja"

## fix nr 59
# magid	3187419915 to magid 1978911463	Isenhart, TM:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3187419915"] <- "1978911463"

## fix nr 60
# magid 2123786699	Jackson, B to Bethanna M. Jackson and Jackson, BM
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2123786699"] <- "Bethanna M."
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "2123786699"] <- "BM"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2123786699"] <- "Jackson, BM."

## fix nr 61
# magid	3065846024 and 2670851849 to magid 1273417835	Jacot, Katja:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3065846024"] <- "1273417835"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2670851849"] <- "1273417835"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "1273417835"] <- "Katja"

## fix nr 62
# magid	2167241711 to magid 2169862143	Jeanneret, Philippe:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2167241711"] <- "2169862143"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2169862143"] <- "Philippe"

## fix nr 63
# magid	2976807732 to magid 2671511903	Kajak, Anna:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2976807732"] <- "2671511903"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2671511903"] <- "Anna"

## fix nr 64
# magid	3180674337 to magid 2132390630	Kallenbach, Robert L.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3180674337"] <- "2132390630"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2132390630"] <- "Robert L."

## fix nr 65
# magid	3058132985 to magid 2466309790	Kaushik, Narinder K.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3058132985"] <- "2466309790"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2466309790"] <- "Narinder K."

## fix nr 66
# magid	3167403767 to magid 3172132651	Kim, D:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3167403767"] <- "3172132651"

## fix nr 67
# magid	2632376671 to magid 1999453829	Kirwan, L:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2632376671"] <- "1999453829"

## fix nr 68
# magid	2656554574 to magid 2918686731	Kiss, Jozsef:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2656554574"] <- "2918686731"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2918686731"] <- "Jozsef"

## fix nr 69
# magid	2907503280 to magid 3055359434	Klaus, Iris:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2907503280"] <- "3055359434"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "3055359434"] <- "Iris"

## fix nr 70
# magid	35993009 to magid 2651887918	Komor, Stephen C.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "35993009"] <- "2651887918"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2651887918"] <- "Stephen C."

## fix nr 71
# magid	2171070111 to magid 2692276939	Kort, J:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2171070111"] <- "2692276939"

## fix nr 72
# magid	2672519493 and 2117555699 to magid 2519480210	Kovar, John L.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2672519493"] <- "2519480210"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2117555699"] <- "2519480210"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2519480210"] <- "John L."

## fix nr 73
# magid	2635859285 to magid 266310396	Kromp, Bernhard:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2635859285"] <- "266310396"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "266310396"] <- "Bernhard"

## fix nr 74
# magid	2974023335 to magid 2300580621	Kujawa, Krzysztof:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2974023335"] <- "2300580621"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2300580621"] <- "Krzysztof"

## fix nr 75
# magid	3171807434 to magid 3180424817	Kumar, S:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3171807434"] <- "3180424817"

## fix nr 76
# magid	2006603341 to magid 2471503772	Kuusemets, V:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2006603341"] <- "2471503772"

## fix nr 77
# magid	2556882891 to magid 2629544079	Labanowska-Bury, Dorota:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2556882891"] <- "2629544079"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2629544079"] <- "Dorota"

## fix nr 78
# magid	3201138460 to magid 2336772887	Lack, Peter C.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3201138460"] <- "2336772887"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2336772887"] <- "Peter C."

## fix nr 79
# magid	2151890652 to magid 2209132334	Landis, Douglas A.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2151890652"] <- "2209132334"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2209132334"] <- "Douglas A."

## fix nr 80
# magid	2487959036 to magid 2714486801	Lang, Andreas:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2487959036"] <- "2714486801"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2714486801"] <- "Andreas"

## fix nr 81
# magid	2637458295 to magid 2785881690	Le Coeur, Didier:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2637458295"] <- "2785881690"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2785881690"] <- "Didier"

## fix nr 82
# magid	2646321672 to magid 2705540922	Lee, K-:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2646321672"] <- "2705540922"
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "2705540922"] <- "KH"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2705540922"] <- "Lee, K.-H."

## fix nr 83
# orcid	0000-0002-2974-3612 to magid 262327925	Leifert, Carlo:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "0000-0002-2974-3612"] <- "262327925"
record_df_data.authors.ids$type[record_df_data.authors.ids$value == "262327925"] <- "magid"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "262327925"] <- "Carlo"

## fix nr 84
# magid 2353247364	Lin, C to Lin, CM:
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2353247364"] <- "Lin, CM"
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "2353247364"] <- "CM"

## fix nr 85
# magid 2172060430	Lin, C to Lin, CH:
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2172060430"] <- "Lin, CH"
record_df_data.authors.ids$initials[record_df_data.authors.ids$value == "2172060430"] <- "CH"

## fix nr 86
# magid	2558214333 to magid 2111173722	Locke, Martin A.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2558214333"] <- "2111173722"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2111173722"] <- "Martin A."

## fix nr 87
# magid	2036535872 to magid 2668440904	Ludy, Claudia:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2036535872"] <- "2668440904"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2668440904"] <- "Claudia"

## fix nr 88
# magid	2673012903 to magid 2073885539	Luka, Henryk:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2673012903"] <- "2073885539"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2073885539"] <- "Henryk"

## fix nr 89
# magid	2672675688 to magid 2148535374	Madrigal, Ismael:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2672675688"] <- "2148535374"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2148535374"] <- "Ismael"

## fix nr 90
# magid	2777650464 to magid 2679527388	Marshall, EJP:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2777650464"] <- "2679527388"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2679527388"] <- "E. J. P."

## fix nr 91
# magid	2488763253 and 2169347235 to magid 2614404664	Mason, Christopher F.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2488763253"] <- "2614404664"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2169347235"] <- "2614404664"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2614404664"] <- "Christopher F."

## fix nr 92
# magid	3035904792 to magid 2574307034	Matheny, TA:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3035904792"] <- "2574307034"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2574307034"] <- "T. A."

## fix nr 93
# magid	1925609584 to magid 2698835659	Maudsley, Martin:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1925609584"] <- "2698835659"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2698835659"] <- "Martin"

## fix nr 94
# magid	3043996765 and 2305706538 to magid 2636487500	McGregor, Keith C.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3043996765"] <- "2636487500"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2305706538"] <- "2636487500"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2636487500"] <- "Keith C."

## fix nr 95
# magid	2763873611 to magid 1989141265	Merot, P:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2763873611"] <- "1989141265"

## fix nr 96
# magid	2600237656 and 2911599796 to magid 2123581830	Moorman, Thomas B.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2600237656"] <- "2123581830"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2911599796"] <- "2123581830"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2123581830"] <- "Thomas B."

## fix nr 97
# magid	2658743912 to magid 2649586665	Mountford, JO:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2658743912"] <- "2649586665"

## fix nr 98
# magid	3130902738 and magid 2011986067 are different people with same Author Nieminen, M - add numbers:	
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "3130902738"] <- "Nieminen, M1"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2011986067"] <- "Nieminen, M2"

## fix nr 99
# magid	2694091630 to magid 1972478770	Olechowicz, E:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2694091630"] <- "1972478770"

## fix nr 100
# magid	3053178510 to magid 2484470641	Otto, Stefan:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3053178510"] <- "2484470641"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2484470641"] <- "Stefan"

## fix nr 101
# magid	2140679796 to magid 3026817438	Parkin, TB:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2140679796"] <- "3026817438"

## fix nr 102
# magid	2805976163 to magid 2462194467	Petit, S:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2805976163"] <- "2462194467"

## fix nr 103
# magid	2577431138 to magid 335605033	Plantegenest, M:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2577431138"] <- "335605033"

## fix nr 104
# magid	2636185091 to magid 2332866815	Puckett, K. Marc:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2636185091"] <- "2332866815"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2332866815"] <- "K. Marc"

## fix nr 105
# orcid	0000-0003-4225-9451 to magid 3039998318	Rahman, MM:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "0000-0003-4225-9451"] <- "3039998318"
record_df_data.authors.ids$type[record_df_data.authors.ids$value == "3039998318"] <- "magid"

## fix nr 106
# magid	2603965551 to magid 2717609878	Rands, MRW:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2603965551"] <- "2717609878"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2717609878"] <- "M. R. W."

## fix nr 107
# magid	3005417640 to magid 1484388629	Rasa, K:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3005417640"] <- "1484388629"

## fix nr 108
# magid	3078110253 to magid 2169169971 Real, Benoit:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3078110253"] <- "2169169971"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2169169971"] <- "Benoit"
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "2169169971"] <- "Real"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2169169971"] <- "Real, B"

## fix nr 109
# magid	345764407 to magid 241315796	Rewa, CA:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "345764407"] <- "241315796"

## fix nr 110
# magid	2981211890 to magid 2295855806	Robertson, Duncan:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2981211890"] <- "2295855806"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2295855806"] <- "Duncan"

## fix nr 111
# magid	2992761126 to magid 2115363680	Sauer, Thomas J.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2992761126"] <- "2115363680"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2115363680"] <- "Thomas J."

## fix nr 112
# magid	3063215599 to magid 2158388169 Beatrice Schupbach:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3063215599"] <- "2158388169"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2158388169"] <- "Beatrice"
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "2158388169"] <- "Schupbach"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2158388169"] <- "Schupbach, B"

## fix nr 113
# magid	2723720423 to magid 2280134996	Senoussi, Rachid:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2723720423"] <- "2280134996"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2280134996"] <- "Rachid"

## fix nr 114
# magid	3197067095 to magid 2290748772	Shaw, David R.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3197067095"] <- "2290748772"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2290748772"] <- "David R."

## fix nr 115
# magid	2702469488 and 3156102152 to magid 2554417526	Sotherton, Nicolas W.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2702469488"] <- "2554417526"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3156102152"] <- "2554417526"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2554417526"] <- "Nicolas W."

## fix nr 116
# magid	2723483715 to magid 1594900231	Spruill, Timothy B.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2723483715"] <- "1594900231"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "1594900231"] <- "Timothy B."

## fix nr 117
# magid	2120825161 to magid 3121162453	Sullivan, DS:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2120825161"] <- "3121162453"

## fix nr 118
# magid	2941149995 to magid 2941113392	Syversen, Nina:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2941149995"] <- "2941113392"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2941113392"] <- "Nina"

## fix nr 119
# magid	3208328870 to magid 2977658324	Tallowin, Jerry R.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3208328870"] <- "2977658324"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2977658324"] <- "Jerry R."

## fix nr 120
# magid	2308657864 and 2034382432 to magid 2311089936	Tattersall, Francoise H.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2308657864"] <- "2311089936"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2034382432"] <- "2311089936"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2311089936"] <- "Francoise H."

## fix nr 121
#publication with lens_id 028-717-958-656-943 is a corrigendum of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "028-717-958-656-943")
record_df <- subset(record_df, data.lens_id != "028-717-958-656-943") #remove from the main dataset
# magid	2643251359 to magid 2109741121	Thomas, C. F. George:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2643251359"] <- "2109741121"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2109741121"] <- "C. F. George"

## fix nr 122
# magid	2504210219 to magid 2074586124	Tierney, Dennis P.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2504210219"] <- "2074586124"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2074586124"] <- "Dennis P."

## fix nr 123
# magid	3072427598 and 3000541873 to magid 2231106999	Tomer, Mark D.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3072427598"] <- "2231106999"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3000541873"] <- "2231106999"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2231106999"] <- "Mark D."

## fix nr 124
#publication with lens_id 144-115-592-302-602 is a duplicate of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "144-115-592-302-602")
record_df <- subset(record_df, data.lens_id != "144-115-592-302-602") #remove from the main dataset
# magid	3179029498 to magid 297348948	Udawatta, Ranjith P.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3179029498"] <- "297348948"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "297348948"] <- "Ranjith P."

## fix nr 125
# magid	2015391856 to magid 2626502302 Jaana Uusi-Kamppa:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2015391856"] <- "2626502302"
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "2626502302"] <- "Uusi-Kamppa"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2626502302"] <- "Uusi-Kamppa, J"

## fix nr 126
# magid	2645408306 to magid 2778234347	Paul C. J. van Rijn:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2645408306"] <- "2778234347"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2778234347"] <- "Paul C. J."

## fix nr 127
# orcis	0000-0002-5425-241X to magid 2242996170	Vellidis, George:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "0000-0002-5425-241X"] <- "2242996170"
record_df_data.authors.ids$type[record_df_data.authors.ids$value == "2242996170"] <- "magid"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2242996170"] <- "George"

## fix nr 128
# magid	2923553631 to magid 2151746401	Vickery, JA:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2923553631"] <- "2151746401"

## fix nr 129
#publication with lens_id 180-256-208-559-265 is a duplicate of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "180-256-208-559-265")
record_df <- subset(record_df, data.lens_id != "180-256-208-559-265") #remove from the main dataset
# magid	2609554350 to magid 2053514387	Vidon, Philippe:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2609554350"] <- "2053514387"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2053514387"] <- "Philippe"

## fix nr 130
# magid	1470328431 to magid 2907375745  Francisco Diaz-Fierros Viqueira:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "1470328431"] <- "2907375745"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2907375745"] <- "Francisco Diaz-Fierros"

## fix nr 131
# magid	2431967633 to magid 2039405485	Felix L. Wackers:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2431967633"] <- "2039405485"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2039405485"] <- "Felix L."
record_df_data.authors.ids$last_name[record_df_data.authors.ids$value == "2039405485"] <- "Wackers"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2039405485"] <- "Wackers, FL"

## fix nr 132
# magid	2702179144 to magid 2114825854	Walton, NJ:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2702179144"] <- "2114825854"

## fix nr 133
# magid	2900559531 to magid 2345524932	David F. Webber:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2900559531"] <- "2345524932"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2345524932"] <- "David F."

## fix nr 134
# magid	2426540393 to magid 2778576021	T. M. West:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2426540393"] <- "2778576021"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2778576021"] <- "T. M."

## fix nr 135
# magid	2557083686 to magid 2259983837	White, Roger:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2557083686"] <- "2259983837"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2259983837"] <- "Roger"

## fix nr 136
# magid	2432530054 to magid 2135638108 Randall G. Williams:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2432530054"] <- "2135638108"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2135638108"] <- "Randall G."

## fix nr 137
# magid	2112963049 and magid 2132846614 are different people with same Author Wilson, JD - add numbers:	
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2112963049"] <- "Wilson, JD1"
record_df_data.authors.ids$Author[record_df_data.authors.ids$value == "2132846614"] <- "Wilson, JD2"

## fix nr 138
# magid	2762378604 to magid 2143915691 Karin Winkler:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2762378604"] <- "2143915691"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2143915691"] <- "Karin"

## fix nr 139
#publication with lens_id 052-121-834-684-873 is a duplicate of another article - remove from the authors dataset:
record_df_data.authors.ids <- subset(record_df_data.authors.ids, data.lens_id != "052-121-834-684-873")
record_df <- subset(record_df, data.lens_id != "052-121-834-684-873") #remove from the main dataset
# magid	3114300772 and 2600713750 to magid 2284387554	Woodbury, BL:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3114300772"] <- "2284387554"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2600713750"] <- "2284387554"

## fix nr 140
# magid	2581687904 and 2988530751 and 3002827677 to magid 2083225834 Stephen D. Wratten:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2581687904"] <- "2083225834"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2988530751"] <- "2083225834"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3002827677"] <- "2083225834"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2083225834"] <- "Stephen D."

## fix nr 141
# magid	3130371620 and 2422744197 to magid 2010841276	Wyss, Eric:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3130371620"] <- "2010841276"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2422744197"] <- "2010841276"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2010841276"] <- "Eric"

## fix nr 142
# magid	3120318805 and 2630821214 to magid 2472204622	Yahner, Richard H.:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "3120318805"] <- "2472204622"
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2630821214"] <- "2472204622"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2472204622"] <- "Richard H."

## fix nr 143
# magid	2703993885 to magid 2108106037	Yli-Halla, M:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2703993885"] <- "2108106037"

## fix nr 144
# magid	2488034465 to magid 838701823	Zangger, Adrian:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2488034465"] <- "838701823"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "838701823"] <- "Adrian"

## fix nr 145
# magid	2683713286 to magid 2429685876	Zyczynska-Baloniak, Irena:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2683713286"] <- "2429685876"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2429685876"] <- "Irena"

## fix nr 146
# magid	2661713076 to magid 2168280740	Carmona, DM:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2661713076"] <- "2168280740"
record_df_data.authors.ids$first_name[record_df_data.authors.ids$value == "2168280740"] <- "Dora Mabel"

## fix nr 147
# magid	2688966438 to magid 2718685829	Corda, E:
record_df_data.authors.ids$value[record_df_data.authors.ids$value == "2688966438"] <- "2718685829"

# #check again how many authors with same name but different ids
# record_df_data.authors.ids %>%
#     group_by(Author) %>%
#     summarise(count = n_distinct(value)) %>%
#     filter(count > 1) -> check_next
# # check_next

dim(record_df) #930 articles
dim(record_df_data.authors.ids) #3419 authors

write.csv(record_df_data.authors.ids, here("data", "record_df_data.authors.ids_cleaned.csv")) #save dataframe as csv

save(record_df, file = here("data", "LENS_dataframe_cleaned.RData")) #save semi-cleaned LENS output as a Rdata object

####### finished cleaning authors ids data frame
```


## Clean affiliation info   

Author information stored on this data frame is not cleaned.  
Country codes used are 2-letter codes in the ISO-3166 alpha2 format.   

Note: considered using refsplitr package, but it also requires manually reviewing and fixing difficult cases, so it is unlikely to simplify this process, given the amount of information and its format.  

```{r clean affiliations country codes, eval = TRUE}

#unnest  affiliations from record_df_data.authors:
record_df_data.authors.aff <- record_df_data.authors %>% select(data.lens_id, data.title, data.publication_type, data.year_published, first_name, last_name, initials, affiliations) %>% unnest(affiliations)
#dim(record_df_data.authors.aff) #2968 - some articles have missing data, esp country ID in ISO-3166 alpha2
#names(record_df_data.authors.aff) #a tibble with unnested ids use for igraph: data.lens_id value
#View(record_df_data.authors.aff)
#table(record_df_data.authors.aff$grid_id, useNA = "always") #780 missing
#table(record_df_data.authors.aff$country_code, useNA = "always")
#table(is.na(record_df_data.authors.aff$country_code)) #885 missing country ID - may need to impute - try https://www.grid.ac/ Global Research Identifier Database (GRID) with name (affiliation name) - use ISO-3166 alpha2 (2-letter codes)

## make a subset with missing country_code data - for visual checks:
sub_aff <- record_df_data.authors.aff[is.na(record_df_data.authors.aff$country_code), ] 
#dim(sub_aff)
#View(sub_aff)
#View(table(sub_aff$name))
#View(record_df_data.authors.aff[!is.na(record_df_data.authors.aff$country_code) & record_df_data.authors.aff$country_code == "NL", ])


## fix affiliations nr 1 
# resolve institutions with grid_id but no country code: grid.414548.8, grid.11417.32, grid.4461.7 = FR (France), grid.475190.e = JO (Jordan)
#table(sub_aff$grid_id)
record_df_data.authors.aff[record_df_data.authors.aff$grid_id %in% c("grid.11417.32","grid.414548.8", "grid.4461.7"), ]$country_code <- "FR"
record_df_data.authors.aff[record_df_data.authors.aff$grid_id %in% c("grid.475190.e"), ]$country_code <- "JO"


## fix affiliations nr 2 
#extract most common country names and their variants from affiliations in "name" and assign country_code (https://www.geonames.org/countries/):
#View(record_df_data.authors.aff[grep("Poland", record_df_data.authors.aff$name), ])
record_df_data.authors.aff[grep("UK", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("U.K.", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("U. K.", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("United Kingdom", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Great Britain", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Scotland", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("USA", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("U.S.A.", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("United States", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Netherlands", record_df_data.authors.aff$name), ]$country_code <- "NL"
record_df_data.authors.aff[grep("Switzerland", record_df_data.authors.aff$name), ]$country_code <- "CH"
record_df_data.authors.aff[grep("France", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Italy", record_df_data.authors.aff$name), ]$country_code <- "IT"
record_df_data.authors.aff[grep("Germany", record_df_data.authors.aff$name), ]$country_code <- "DE"
record_df_data.authors.aff[grep("Finland", record_df_data.authors.aff$name), ]$country_code <- "FI"
record_df_data.authors.aff[grep("Japan", record_df_data.authors.aff$name), ]$country_code <- "JP"
record_df_data.authors.aff[grep("Poland", record_df_data.authors.aff$name), ]$country_code <- "PL"
record_df_data.authors.aff[grep("Canada", record_df_data.authors.aff$name), ]$country_code <- "CA"
record_df_data.authors.aff[grep("Argentina", record_df_data.authors.aff$name), ]$country_code <- "AR"
record_df_data.authors.aff[grep("Belgium", record_df_data.authors.aff$name), ]$country_code <- "BE"
record_df_data.authors.aff[grep("Spain", record_df_data.authors.aff$name), ]$country_code <- "ES"
record_df_data.authors.aff[grep("China", record_df_data.authors.aff$name), ]$country_code <- "CN"
record_df_data.authors.aff[grep("Estonia", record_df_data.authors.aff$name), ]$country_code <- "EE"
record_df_data.authors.aff[grep("Norway", record_df_data.authors.aff$name), ]$country_code <- "NO"
record_df_data.authors.aff[grep("Sweden", record_df_data.authors.aff$name), ]$country_code <- "SE"
record_df_data.authors.aff[grep("Denmark", record_df_data.authors.aff$name), ]$country_code <- "DK"
record_df_data.authors.aff[grep("Austria", record_df_data.authors.aff$name), ]$country_code <- "AT"
record_df_data.authors.aff[grep("Indonesia", record_df_data.authors.aff$name), ]$country_code <- "ID"
record_df_data.authors.aff[grep("New Zealand", record_df_data.authors.aff$name), ]$country_code <- "NZ"
record_df_data.authors.aff[grep("Australia", record_df_data.authors.aff$name), ]$country_code <- "AU"
record_df_data.authors.aff[grep("Taiwan", record_df_data.authors.aff$name), ]$country_code <- "TW"
record_df_data.authors.aff[grep("Slovakia", record_df_data.authors.aff$name), ]$country_code <- "SK"
record_df_data.authors.aff[grep("Luxembourg", record_df_data.authors.aff$name), ]$country_code <- "LU"


## fix affiliations nr 3   
#For the remaining records use other information from affiliations in "name" (e.g. region, city, institution names) and use it to assign country_code (https://www.geonames.org/countries/):
record_df_data.authors.aff[grep("British", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Devon", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Norfolk", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Chinese", record_df_data.authors.aff$name), ]$country_code <- "CN"
record_df_data.authors.aff[grep("Rennes", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Paris", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Lille", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Nancy", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Canadian", record_df_data.authors.aff$name), ]$country_code <- "CA"
record_df_data.authors.aff[grep("Ontario", record_df_data.authors.aff$name), ]$country_code <- "CA"
record_df_data.authors.aff[grep("Québec", record_df_data.authors.aff$name), ]$country_code <- "CA"
record_df_data.authors.aff[grep("Montréal", record_df_data.authors.aff$name), ]$country_code <- "CA"
record_df_data.authors.aff[grep("Nebraska", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Virginia", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Maryland", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Texas", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Iowa", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Louisiana", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Kentucky", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Lincoln", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Missouri", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Wisconsin", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Delaware", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("New Hampshire", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("California", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Columbia", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("Polish", record_df_data.authors.aff$name), ]$country_code <- "PL"
record_df_data.authors.aff[grep("Lublin", record_df_data.authors.aff$name), ]$country_code <- "PL"
record_df_data.authors.aff[grep("Hobart", record_df_data.authors.aff$name), ]$country_code <- "AU"
record_df_data.authors.aff[grep("Monash", record_df_data.authors.aff$name), ]$country_code <- "AU"
record_df_data.authors.aff[grep("Scottish", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Belgorod", record_df_data.authors.aff$name), ]$country_code <- "RU"
record_df_data.authors.aff[grep("Russian", record_df_data.authors.aff$name), ]$country_code <- "RU"
record_df_data.authors.aff[grep("Kavala", record_df_data.authors.aff$name), ]$country_code <- "GR"
record_df_data.authors.aff[grep("Brno", record_df_data.authors.aff$name), ]$country_code <- "CZ"
record_df_data.authors.aff[grep("Padova", record_df_data.authors.aff$name), ]$country_code <- "IT"
record_df_data.authors.aff[grep("La Mancha", record_df_data.authors.aff$name), ]$country_code <- "ES"

record_df_data.authors.aff[grep("Agricultural Research Center", record_df_data.authors.aff$name), ]$country_code <- "FI"
record_df_data.authors.aff[grep("Institut national de la recherche agronomique", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Edward Grey Institute of Field Ornithology", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("NERC", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Technische", record_df_data.authors.aff$name), ]$country_code <- "DE"
record_df_data.authors.aff[grep("Sol Agro et hydrosystème Spatialisation", record_df_data.authors.aff$name), ]$country_code <- "FR"
record_df_data.authors.aff[grep("Southeast Watershed Research Lab", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("IRSA", record_df_data.authors.aff$name), ]$country_code <- "IT"
record_df_data.authors.aff[grep("Hill & Mountain Research Centre", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Nova Scotia Agricultural College", record_df_data.authors.aff$name), ]$country_code <- "CA"
record_df_data.authors.aff[grep("Wellington Management Company", record_df_data.authors.aff$name), ]$country_code <- "US"
record_df_data.authors.aff[grep("The Lodge", record_df_data.authors.aff$name), ]$country_code <- "GB"
record_df_data.authors.aff[grep("Science and Health", record_df_data.authors.aff$name), ]$country_code <- "AU"
record_df_data.authors.aff[grep("Plant and Ecological Sciences l", record_df_data.authors.aff$name), ]$country_code <- "NZ"
record_df_data.authors.aff[grep("Cooperative Research Centre", record_df_data.authors.aff$name), ]$country_code <- "AU"
record_df_data.authors.aff[grep("Plant Ecology and Nature Conservation", record_df_data.authors.aff$name), ]$country_code <- "NL"
record_df_data.authors.aff[grep("Facultad de Ciencias Exactas y Naturales", record_df_data.authors.aff$name), ]$country_code <- "AR"

##Note: only 75 left unresolved - too vague, unless going back to original papers to see whole affiliation info

par(mar=c(4,18,2,2))
barplot(sort(sort(table(record_df_data.authors.aff$country_code),decreasing = TRUE)[1:10]), horiz=TRUE, las=1, xlab = "Count", main = "Top10 affiliation countries ")

#save affiliations table
write.csv(record_df_data.authors.aff, here("data", "record_df_data.authors.aff_cleaned.csv"))
#record_df_data.authors.aff <- read.csv(here("data", "record_df_data.authors.aff_cleaned.csv"))

#Note: did not clean actual institutional affiliation info ("name"), only country codes
```

Data wrangling and cleaning summary:    
- Flattened some of the tables into data frames (author identity info, affiliation country info)  
- Author data: cleaned ids, names and initials 
- Affiliation data: main cleaning and imputation of missing country code values done (only 75 records left with unassigned country code), grid.id not cleaned or imputed (seem to be more tidy)

#load(file = here("data", "LENS_dataframe_cleaned.RData")) #loads semi-cleaned LENS output from a Rdata object - "record_df"
